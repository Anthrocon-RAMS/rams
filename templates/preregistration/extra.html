<script type="text/javascript">
    var affChanged = function(startup) {
        var newAff = $.field("aff_select")[0].selectedIndex === 0;
        setVisible("#affdiv", newAff);
        if (!newAff) {
            $.field("aff_text").val("");
        } else if (!startup) {
            $.focus("aff_text");
        }
    };
    var donationChanged = function() {
        setVisible(".affiliate-row", $.val("amount_extra") > 0);
        setVisible(".shirt-row", $.val("amount_extra") >= {{ SHIRT_LEVEL }});
        {% if attendee.badge_type == STAFF_BADGE %}
            setVisible(".badge-row", true);
        {% else %}
            setVisible(".badge-row", $.val("amount_extra") >= {{ SUPPORTER_LEVEL }});
        {% endif %}
    };
    $(function(){
        donationChanged();
        affChanged(true);
        var format = function(opt) {
            if (opt.id == {{ SUPPORTER_LEVEL }} || opt.id == {{ SEASON_LEVEL }}) {
                return '<span class="select2-bolded">' + opt.text + '</span>';
            } else {
                return opt.text;
            }
        };
        $.field("amount_extra").select2({
            formatResult: format,
            formatSelection: function(opt) { return opt.text; },
            minimumResultsForSearch: 99,
            escapeMarkup: function(m) { return m; }
        });
        $("form").submit(function(){
            $(":submit").attr("value", "Uploading Preregistration...").attr("disabled", true);
        });
    });
</script>

{% if attendee.badge_type != PSEUDO_DEALER_BADGE and attendee.badge_type != PSEUDO_GROUP_BADGE %}
    <tr class="extra-row">
        <td><b>Want to kick in extra?</b></td>
        <td>
            <select name="amount_extra" style="width:50%" onChange="donationChanged()">
                {% options DONATION_OPTS attendee.amount_extra %}
            </select>
            &nbsp;
            <nobr>{% popup_link "../static/givingExtra.html" "Why do this?" %}</nobr>
        </td>
    </tr>
{% endif %}
<tr class="badge-row extra-row" style="display:none">
    <td> <b>Name Printed on Badge:</b> </td>
    <td>
        <input type="text" name="badge_printed_name" value="{{ attendee.badge_printed_name }}" {% if CUSTOM_BADGES_ORDERED %}readonly{% endif %} />
        {% if CUSTOM_BADGES_ORDERED %}
            <br/> <i>(custom badges have already been ordered, so you can no longer set this)</i>
        {% endif %}
    </td>
</tr>
<tr class="affiliate-row extra-row" style="display:none">
    <td valign="top"> <b>Affiliate:</b> </td>
    <td>
        <select name="aff_select" onChange="affChanged()">
            <option value="">---Other---</option>
            <option value="" {% if not attendee.affiliate %}selected{% endif %}>I don't care about this</option>
            {% options affiliates attendee.affiliate %}
        </select>
        &nbsp; <span class="popup">{% popup_link "../static/affiliates.html" "What's an affiliate?" %}</span>
        <div id="affdiv">
            <br/> <input type="text" name="aff_text" value="{{ attendee.affiliate|default:"" }}" />
        </div>
    </td>
</tr>
<tr class="shirt-row extra-row" style="display:none">
    <td> <b>Shirt Size</b> </td>
    <td>
        <select name="shirt">
            <option value="{{ NO_SHIRT }}">Select a shirt size</option>
            {% options PREREG_SHIRT_OPTS attendee.shirt %}
        </select>
    </td>
</tr>
