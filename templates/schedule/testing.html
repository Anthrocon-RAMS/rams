<!doctype html>
<html>
    <head>
        <title>MAGFest - Schedule</title>
        <link rel="stylesheet" type="text/css" href="../static/extjs/resources/css/ext-all.css" />
        <script type="text/javascript" src="../static/extjs/ext-all-dev.js"></script>
        <script type="text/javascript">
            Ext.namespace("App");
            Ext.Loader.setConfig({
                enabled: true,
                paths: {"App": "js/App"}
            });
            Ext.onReady(function() {
                App.epoch = 1000 * {{ state.EPOCH|timestamp }};
                App.rowToTime = function(i) {
                    return Ext.Date.format(new Date(App.epoch + 1000 * 60 * 30 * i), "D H:ia");
                };
                App.viewport = Ext.create("Ext.container.Viewport", {
                    layout: "hbox",
                    items: [
                        {
                            xtype: "gridpanel",
                            disableSelection: true,
                            width: 100,
                            store: {
                                fields: ["startTime"],
                                data: [{% for dt,formatted in START_TIME_OPTS %}[{{ forloop.counter0 }}],{% endfor %}]
                            },
                            columns: [{
                                flex: 1,
                                dataIndex: "startTime",
                                renderer: function(value, metaData, record, rowIndex) {
                                    return '<div style="height: 50px">' + App.rowToTime(rowIndex) + '</div>';
                                }
                            }]
                        },
                        {% for loc,desc in EVENT_LOC_OPTS %}
                            Ext.create("App.ScheduleGrid", {
                                locationId: {{ loc }},
                                locationName: "{{ desc }}"
                            })
                            {% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ]
                });
                App.eventMenu = Ext.create("Ext.menu.Menu", {
                    plain: true,
                    items: [{
                        text: "Edit",
                        handler: function(menu, item, event) {
                            console.log("Edit clicked");
                        }
                    }]
                });
                App.blankMenu = Ext.create("Ext.menu.Menu", {
                    plain: true,
                    items: [{
                        text: "Move an event here",
                        handler: function(menu, item, event) {
                            Ext.create("Ext.window.Window", {
                                title: "Select an Event",
                                items: [{
                                    xtype: "combobox",
                                    allowBlank: false,
                                    editable: false,
                                    store: Ext.create("Ext.data.JsonStore", {
                                        fields: ["id", "full_name"],
                                        proxy: {
                                            type: "ajax",
                                            url: "available_events",
                                            reader: {
                                                type: "json",
                                                root: "events",
                                                idProperty: "id"
                                            }
                                        }
                                    })
                                }],
                                buttons: [{
                                    text: "Cancel",
                                    handler: function() {
                                        this.up("window").close();
                                    }
                                }, {
                                    text: "Move",
                                    formBind: true,
                                    disabled: true,
                                    handler: function(btn) {
                                        
                                    }
                                }]
                            }).show();
                        }
                    }]
                });
            });
        </script>
        <style type="text/css">
            .eventform .x-panel-body {
                padding: 5px;
            }
            .x-grid-table {
                /* border-collapse: collapse; */
            }
            .x-grid-row .x-grid-cell {
                border: 1px solid black;
            }
            .x-grid-row .x-grid-cell .x-grid-cell-inner {
                padding: 0px;
            }
            .x-panel .x-grid-body {
                border: 0px;
            }
        </style>
    </head>
    <body>
    </body>
</html>
