{% extends "base.html" %}
{% import "forms/attendee.html" as attendee_fields with context %}
{% import "forms/group.html" as group_fields with context %}
{% import "forms/account.html" as account_fields with context %}
{% import 'forms/macros.html' as form_macros with context %}
{% block title %}Preregistration{% endblock %}
{% block content %}
  {% if c.PAGE_PATH == '/preregistration/dealer_registration' %}
    {% include 'preregistration/disclaimer_popup.html' %}
  {% elif c.ATTENDEE_ACCOUNTS_ENABLED and not logged_in_account %}
  <script type="text/javascript">
    $(document).ready(function() {
      $("#account-form").submit(function () { $("#prereg-form").submit(); });
      $("#prereg-form").submit(function () { 
        var success = validateAndIncludeAccountFields();
          if (!success) {
            return false;
          }
          if(!$(this)[0].checkValidity()) {
            $(this)[0].reportValidity();
            return false;
          }
        });
    });
  </script>
  {% endif %}
  {{ attendee_fields.amount_extra_js }}
{% include 'prereg_masthead.html' %}
{% set original_location = ".." ~ c.PAGE_PATH %}
<div class="card">
  <div class="card-body">
  {{ attendee_fields.prereg_intro }}

  {{ form_macros.form_validation('dealer-form', 'validate_dealer') }}

{#- The action is set to "post_form" or "post_dealer" in order to bypass the NGINX cache. -#}
<form method="post" id="dealer-form" action="post_dealer" class="form-horizontal" role="form">
{% if edit_id %}
    <input type="hidden" name="edit_id" value="{{ edit_id }}" />
{% endif %}
{{ csrf_token() }}

<h3 class="text-center">{{ c.DEALER_APP_TERM|title }} Info</h3>

  {% include "forms/table_info.html" %}

<h3 class="text-center">{{ c.DEALER_TERM|title }} Contact Info</h3>
  {% include "forms/contact_info.html" %}

  {# Deprecated forms included for backwards compatibility with old plugins #}
  {% include "groupform.html" %}

<div class="form-group">
    <div class="col-sm-9 col-sm-offset-3">
        {% if edit_id %}
            <button type="submit" class="btn btn-primary" name="go_to_cart" value="1">Update</button>
        {% endif %}
        <button type="submit" class="btn btn-{% if edit_id %}outline-{% endif %}primary" value="Next">Next</button>
    </div>
</div>

</form>

</div>
</div>

{% endblock %}